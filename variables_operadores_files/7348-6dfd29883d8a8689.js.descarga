"use strict";(self.webpackChunkcircle=self.webpackChunkcircle||[]).push([["7348"],{384866:function(t,e,n){n.d(e,{G7:()=>p,JB:()=>y,nw:()=>g});var r,o=n(683551),i=n(314121),a=n(100334),u=n(424790),c=n(41310);function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n,r,o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var i=[],a=!0,u=!1;try{for(o=o.call(t);!(a=(n=o.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,r=t}finally{try{a||null==o.return||o.return()}finally{if(u)throw r}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}}(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var p={INBOX:"inbox",CONTENT:"content",MENTIONS:"mentions",FOLLOWING:"following",MODERATION:"moderation",ALL:"all",ARCHIVED:"archived"},b=(s(r={},p.INBOX,(0,a.t)("notifications.group_tabs.inbox")),s(r,p.CONTENT,(0,a.t)("notifications.group_tabs.content")),s(r,p.MENTIONS,(0,a.t)("notifications.group_tabs.mentions")),s(r,p.FOLLOWING,(0,a.t)("notifications.group_tabs.following")),s(r,p.MODERATION,(0,a.t)("notifications.group_tabs.moderation")),s(r,p.ALL,(0,a.t)("notifications.group_tabs.all")),s(r,p.ARCHIVED,(0,a.t)("notifications.group_tabs.archived")),r),d=(0,i.createContext)(null);d.displayName="NotificationContext";var y=function(t){var e=t.children,n=t.onClose,r=(0,u.t)().setDesktopAppNotificationCount,a=f((0,i.useState)(p.INBOX),2),l=a[0],y=a[1],g=f((0,i.useState)({inbox:0,mentions:0,notifications:0}),2),v=g[0],h=g[1],O=(0,c._)("notification_last_marked_as_read"),m=O.setValue,w=(0,O.getValue)()||null,_=v.notifications;return(0,i.useEffect)(function(){r(_)},[_]),(0,o.jsx)(d.Provider,{value:{activeTab:l,setActiveTab:y,notificationCount:_,setNotificationCount:function(t){var e,n;h((e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){s(t,e,n[e])})}return t}({},v),n=n={notifications:t},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):(function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n.push.apply(n,r)}return n})(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e))},getTabLabel:function(t){return b[t]},onClose:n,setNotificationTabCounters:h,lastMarkedAsRead:w,setLastMarkedAsRead:m},children:e})},g=function(){var t=(0,i.useContext)(d);if(!t)throw Error("useNotificationContext must be used within a NotificationProvider");return t}},674701:function(t,e,n){n.d(e,{bh:()=>g,SA:()=>v,hR:()=>y,uQ:()=>b,Io:()=>h,s5:()=>O,N7:()=>d});var r=n(214813),o=n(714844),i=n(633262),a=n(547550),u=n(384866);function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){n(t);return}u.done?e(c):Promise.resolve(c).then(r,o)}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){var r;r=n[e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r})}return t}function f(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):(function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n.push.apply(n,r)}return n})(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t}var p={mark_as_read:function(t){var e=t.id;return(0,a.gN)(i.N.markAsRead({id:e}))},mark_all_as_read:function(){return(0,a.Cu)(i.N.markAllAsRead({}))},follow:function(t){var e=t.postId;return(0,a.Cu)(i.N.follow({postId:e}))},unfollow:function(t){var e=t.postId,n=t.followerId;return(0,a.pC)(i.N.unfollow({postId:e,followerId:n}))},archive:function(t){var e=t.id;return(0,a.gN)(i.N.archive({id:e}))}},b=function(t){t.queryClient.invalidateQueries(["notifications"])},d=function(t){t.queryClient.invalidateQueries(["notifications","count"])},y=function(t){var e,n=t.notification,r=t.queryClient,o=["notifications",u.G7.INBOX],i=r.getQueryData(o);if(null==i||null==(e=i.pages)?void 0:e.length){var a=i.pages[0];if(!new Set(a.records.map(function(t){return t.id})).has(n.id)){var l,p=[n].concat(function(t){if(Array.isArray(t))return c(t)}(l=a.records)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(l)||function(t,e){if(t){if("string"==typeof t)return c(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}}(l)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).slice(0,15),b=p[p.length-1],d=b?String(b.id):a.next_search_after,y=f(s({},a),{records:p,total_count:a.total_count+1,has_next_page:!0,next_search_after:d});r.setQueryData(o,f(s({},i),{pages:[y],pageParams:[i.pageParams[0]]}))}}},g=function(t){var e=t.perPage,n=void 0===e?15:e,r=t.notificationGroup,c=void 0===r?u.G7.INBOX:r,s=(0,o.useInfiniteQuery)(["notifications",c],function(t){var e,r=t.pageParam,o=void 0===r?1:r;return(e=function(){var t,e;return function(t,e){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(c){var l=[u,c];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){i.label=l[1];break}if(6===l[0]&&i.label<o[1]){i.label=o[1],o=l;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(l);break}o[2]&&i.ops.pop(),i.trys.pop();continue}l=e.call(t,i)}catch(t){l=[6,t],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){return t={per_page:String(n),notification_group:c},1===o||(null==(e=null==p?void 0:p.pages[o-2])?void 0:e.next_search_after)&&(t.next_search_after=e.next_search_after),t.page=o,[2,(0,a.UT)(i.N.fetch(t))]})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(t){l(i,r,o,a,u,"next",t)}function u(t){l(i,r,o,a,u,"throw",t)}a(void 0)})})()},{staleTime:6e4,getNextPageParam:function(t){return t.has_next_page?t.page+1:void 0}}),f=s.isLoading,p=s.data,b=s.refetch,d=s.fetchNextPage,y=s.isFetchingNextPage,g=null==p?void 0:p.pages[(null==p?void 0:p.pages.length)-1];return{isLoading:f,isFetchingNextPage:y,notifications:p,refetch:b,fetchNextPage:d,hasNextPage:!!(null==g?void 0:g.has_next_page)}},v=function(t,e){return(0,o.useQuery)(["notifications","count",t],function(){return(0,a.UT)(i.N.fetchNotificationCount({community_id:t}))},{enabled:!!t,onSuccess:function(t){var n=t.new_notifications_count,r=t.new_mentions_count;e({inbox:t.new_inbox_count,mentions:r,notifications:n})}})},h=function(t){return{mutate:(0,o.useMutation)(function(){return(0,a.Cu)(i.N.resetNotificationCount())},{onSuccess:function(e){t(e.new_notifications_count)}}).mutate}},O=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.noop,e=(0,o.useQueryClient)(),n=(0,o.useMutation)(function(t){var e=t.action,n=t.id,r=t.postId,o=t.followerId;return p[e]({id:n,postId:r,followerId:o})},{onSuccess:function(n){b({queryClient:e}),t(n)}});return{mutate:n.mutate,isLoading:n.isLoading}}}}]);
//# sourceMappingURL=/packs/js/7348-6dfd29883d8a8689.js.map